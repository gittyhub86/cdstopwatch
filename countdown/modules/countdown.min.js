"use strict";function datePretty(){return function(t){if(t){var e=t.toString(),i=e.replace(/:\d\d\s.+/,"",""),r=e.match(/\d\d\d\d\s\d\d/)[0].split(" ")[1];return"00"==r?i=i.replace(r,"12")+" AM":r<"12"?i+=" AM":"12"==r?i+=" PM":(a=r,n=i.split(" "),o=n[n.length-1].split(":")[1],n[n.length-1]=a,n[n.length-1]={13:"1",14:"2",15:"3",16:"4",17:"5",18:"6",19:"7",20:"8",21:"9",22:"10",23:"11",24:"12"}[n[n.length-1]],i=n.join(" ")+":"+o+" PM"),i}return t;var a,n,o}}function stopWatchPretty(){return function(t){if(t){var e=Math.floor(t/1e3%60),i=Math.floor(t/1e3/60%60),r=Math.floor(t/36e5%24),a=Math.floor(t/100%10);return r<10&&(r="0"+r),i<10&&(i="0"+i),e<10&&(e="0"+e),r+":"+i+":"+e+"."+a}return t}}function timer(){return{templateUrl:"templates/main.html",controller:"timerCtrl",controllerAs:"ctrl"}}function stopWatch(){return{templateUrl:"templates/stopwatch.html",controller:"stopWatchCtrl",controllerAs:"stopWatch"}}function fadeSec(){return{restrict:"A",controller:"timerCtrl",link:function(t,e,i){var r=.9;t.$watch(function(t){return t.$eval("ctrl.fadeSecs")},function(t,i){var a;void 0!==i&&(a=.05,angular.isNumber(a)&&a>0&&(r-=a,e.css("opacity",r))),t<0&&(e.css("opacity",1),r=.9)})}}}function TimerCtrl(t,e){var i,r,a=this,n=new Date;this.monthVal=n.getMonth()+1,this.yearVal=n.getFullYear(),this.dateVal=n.getDate(),this.hourVal=n.getHours(),this.minuteVal=0,this.userDate,this.seconds,this.minutes,this.hours,this.days,this.invalidTime,this.nanTime,this.countdownComplete,this.clickedStop,this.countdown=function(){if(this.invalidTime=!1,this.nanTime=!1,this.countdownComplete=!1,this.errArr=[],this.userDate=new Date(this.yearVal,this.monthVal-1,this.dateVal,this.hourVal,this.minuteVal),!l())return this.userDate=null,void this.stopCountdown();var t="/servertime/"+encodeURIComponent((new Date).getTimezoneOffset()/60);e.get(t).then(s)},this.stopCountdown=function(){r&&o()},this.disableButton=!1;var o=function(){window.cancelAnimationFrame(r),r=void 0,a.clickedStop||(a.countdownComplete=!0),a.validDate=!1,a.disableButton=!1},s=function(t){if(t.data){var e=new Date(a.yearVal,a.monthVal-1,a.dateVal,a.hourVal,a.minuteVal);if(a.serverTime=new Date(t.data),!a.serverTime||null==a.serverTime||isNaN(a.serverTime))return void(a.nanTime=!0);e<a.serverTime?(a.validDate=!1,a.invalidTime=!0):(a.userClockStart=new Date,a.validDate=!0,a.invalidTime=!1,a.disableButton=!0,(i=window.requestAnimationFrame||mozRequestAnimationFrame)(u))}else a.nanTime=!0},l=function(){return(isNaN(a.monthVal)||a.monthVal<1||a.monthVal>12)&&a.errArr.push("Month must be between 1 and 12"),(isNaN(a.dateVal)||a.dateVal<1||a.dateVal>31)&&a.errArr.push("Day must be between 1 and 31"),(isNaN(a.hourVal)||a.hourVal<0||a.hourVal>24)&&a.errArr.push("Hour value must be an integer between 0 and 24"),(isNaN(a.minuteVal)||a.minuteVal<0||a.minuteVal>59)&&a.errArr.push("Minutes must be between 0 and 59"),(isNaN(a.yearVal)||a.yearVal<0)&&a.errArr.push("Year must be greater than 1"),!(a.errArr.length>0)},u=function e(){t.$apply(function(){var t=new Date,n=a.userDate-(a.serverTime.getTime()+(t.getTime()-a.userClockStart));if(a.seconds=Math.floor(n/1e3%60),a.minutes=Math.floor(n/1e3/60%60),a.hours=Math.floor(n/36e5%24),a.days=Math.floor(n/864e5),n<11e3&&(a.fadeSecs=a.seconds),n<0)return a.validDate=!1,a.disableButton=!1,a.clickedStop=!1,void a.stopCountdown();r=i(e)})}}function StopWatchCtrl(t){var e,i,r=this;this.started,this.startTime,this.time="0",this.start=function(){this.started=!0,(e=window.requestAnimationFrame||window.mozRequestAnimationFrame)(n)},this.pause=function(){i&&(window.cancelAnimationFrame(i),this.pausedTime=this.time,this.startTime=null,this.started=!1)},this.pausedTime=0,this.reset=function(){i&&(window.cancelAnimationFrame(i),i=null,this.startTime=null,this.pausedTime=0,this.time="0",this.started=!1)};var a=function(){var t=new Date;r.startTime?r.time=t-r.startTime+r.pausedTime:r.startTime=new Date},n=function r(){t.$apply(a),i=e(r)}}var app=angular.module("components",[]).directive("timer",timer).directive("stopWatch",stopWatch).directive("fadeSec",fadeSec).controller("timerCtrl",["$scope","$http",TimerCtrl]).controller("stopWatchCtrl",["$scope",StopWatchCtrl]).filter("datePretty",datePretty).filter("stopWatchPretty",stopWatchPretty);angular.module("main",["ngRoute","components"]).config(["$routeProvider",function(t){t.when("/",{template:"<timer></timer>"}),t.when("/stopwatch",{template:"<stop-watch></stop-watch>"})}]);